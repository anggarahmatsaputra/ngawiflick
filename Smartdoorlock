#include <ESP8266WiFi.h> 
#include <FirebaseESP8266.h> 
 
#define WIFI_SSID "iPhone" 
#define WIFI_PASSWORD "gilaluya" 
 
#define FIREBASE_HOST "https://smartdoor-4ff0c-default-rtdb.asiasoutheast1.firebasedatabase.app" 
#define FIREBASE_SECRET "AIzaSyDBbETNBk61ohJNtT3_UHsg7-
BqAKigOVU" 
 
#define SELENOID_KANAN D4 
#define BUZZER_KANAN D6 
 
FirebaseData firebaseData; 
 
// Simpan status pintu sebelumnya 
String statusSebelumnya = ""; 
 
// Digunakan untuk menentukan kapan pintu harus kembali terkunci unsigned long waktuDibuka = 0; 
 
void setup() {   Serial.begin(9600);  // Initialize WiFi 
 WiFi.begin(WIFI_SSID, WIFI_PASSWORD); 
  Serial.print("Connecting to WiFi");   while (WiFi.status() != WL_CONNECTED) { 
    Serial.print(".");     delay(500); 
  } 
  Serial.println(); 
  Serial.println("Connected to WiFi"); 
 
  // Initialize Firebase 
  Firebase.begin(FIREBASE_HOST, FIREBASE_SECRET); 
 
  // Set relay pin mode 
  pinMode(SELENOID_KANAN, OUTPUT);   pinMode(BUZZER_KANAN, OUTPUT); 
 
  // Set default state to locked 
  digitalWrite(SELENOID_KANAN, LOW); 
} 
 
void loop() { 
  BacaStatusSelenoidKanan();   delay(1000); 
 
  // Jika pintu dibuka, cek apakah sudah 10 detik 
  if (statusSebelumnya == "unlocked" && (millis() - waktuDibuka) >= 10000) { 
    // Kunci pintu setelah 10 detik 
    digitalWrite(SELENOID_KANAN, LOW); 
   Firebase.setString(firebaseData, "/ruang1/pintu2", "locked");    statusSebelumnya = "locked"; 
 
    // Buzzer bunyi saat kembali terkunci     digitalWrite(BUZZER_KANAN, HIGH); 
    delay(1000); 
    digitalWrite(BUZZER_KANAN, LOW); 
  } 
} 
 
void BacaStatusSelenoidKanan() {   if (Firebase.getString(firebaseData, "/ruang1/pintu2")) {     if (firebaseData.dataType() == "string") {       String selenoidKanan = firebaseData.stringData(); 
      Serial.println("Received door status from Firebase: " + selenoidKanan); 
 
      if (selenoidKanan != statusSebelumnya) { // Hanya jika status berubah         if (selenoidKanan == "unlocked") {           digitalWrite(SELENOID_KANAN, HIGH); 
 
          // Simpan waktu saat pintu dibuka           waktuDibuka = millis(); 
 
          // Buzzer dinyalakan saat pintu dibuka           digitalWrite(BUZZER_KANAN, HIGH); 
          delay(1000); 
          digitalWrite(BUZZER_KANAN, LOW);         } else if (selenoidKanan == "locked") {           digitalWrite(SELENOID_KANAN, LOW);          // Buzzer dinyalakan saat terkunci           digitalWrite(BUZZER_KANAN, HIGH); 
          delay(1000); 
          digitalWrite(BUZZER_KANAN, LOW); 
        } 
 
        // Perbarui status sebelumnya         statusSebelumnya = selenoidKanan; 
      } 
    } 
  } 
} 
 
